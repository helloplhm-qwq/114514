/*!
 * @name Moonsea
 * @description 疯狂周末特别版|将于2023/07/31 00:00:00失效
 * @version v1.0.2
 * @author helloplhm-qwq
 */

const{EVENT_NAMES,on,send,request,utils,version}=window.lx;const qualitys=["128k","320k","flac","flac24bit"];const actions=["musicUrl"];const f=(url,options)=>{return new Promise((resolve,reject)=>{request(url,options,(err,resp)=>{if(err)return reject(err);resolve(resp)})})};const m={async c(s,z,quality){const l={comm:{module:"server.base.apis",method:"SongURL"},req:{source:s,data:s==="kg"?{hash:z.hash,thash:z._types[quality].hash.toLowerCase(),album_id:z.album_id,quality:quality}:{songId:String(z.songmid),quality:quality}}};const u="https://plhm.folltoshe.com/cgi-bin/client/api.fcg?sign=helloplhm-qwq&expire=1690732800";const r=await f(u,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":`moonsea-publicTrial/1.0.2`},body:l});const{body:p}=r;if(p.code!=200||p.req.code!=200)throw new Error(p.req.message??p.message??"get music url failed");return p.req.url}};const kw={info:{name:"",type:"music",actions:actions,qualitys:qualitys},actions:{async musicUrl(info,quality){return await m.c("kw",info,quality)}}};const kg={info:{name:"",type:"music",actions:actions,qualitys:qualitys},actions:{async musicUrl(info,quality){return await m.c("kg",info,quality)}}};const tx={info:{name:"",type:"music",actions:actions,qualitys:qualitys},actions:{async musicUrl(info,quality){return await m.c("tx",info,quality)}}};const wy={info:{name:"",type:"music",actions:actions,qualitys:qualitys},actions:{async musicUrl(info,quality){return await m.c("wy",info,quality)}}};const mg={info:{name:"",type:"music",actions:actions,qualitys:qualitys},actions:{async musicUrl(info,quality){return await m.c("mg",info,quality)}}};const source={infos:{},modules:{kw:kw,kg:kg,tx:tx,wy:wy,mg:mg}};Object.keys(source.modules).forEach(item=>{source.infos[item]=source.modules[item].info});const src_source=source;const em="源脚本已过期";const exp="2023/07/30 23:59:59";on(EVENT_NAMES.request,({source,action,info})=>{let cd=new Date;let dl=new Date(exp);if(cd>dl){console.error(em);return new Error(em)}switch(action){case"musicUrl":return src_source.modules[source].actions.musicUrl(info.musicInfo,info.type).then(data=>Promise.resolve(data)).catch(err=>Promise.reject(err))}});let dn=new Date;let de=new Date(exp);if(dn<de){send(EVENT_NAMES.inited,{status:true,openDevTools:false,sources:src_source.infos})}else{send(EVENT_NAMES.inited,{status:false,openDevTools:true,sources:null});console.error(em)}
